# 设置页面密码保护功能

## 功能概述

为了保护系统设置的安全性，设置页面现在需要管理员密码验证才能访问。

## 功能特点

### 🔐 密码保护
- 访问设置页面需要输入管理员密码
- 密码验证通过后会创建30分钟的会话
- 会话过期后需要重新验证

### 🕒 会话管理
- 会话有效期：30分钟
- 自动检测会话状态
- 会话过期自动跳转到首页
- 实时显示剩余会话时间

### 🛡️ 安全特性
- 密码在服务端验证
- 防暴力破解延迟（1秒）
- 会话状态存储在sessionStorage中
- 支持手动退出登录

## 使用方法

### 1. 设置管理员密码

#### 方法一：使用环境变量（推荐）
1. 复制 `.env.example` 为 `.env.local`
2. 设置您的管理员密码：
```bash
ADMIN_PASSWORD=your_secure_password_here
```

#### 方法二：使用默认密码
如果不设置环境变量，系统将使用默认密码：`1Allforone`

### 2. 访问设置页面

1. 点击首页右上角的"设置"按钮
2. 在弹出的密码验证窗口中输入管理员密码
3. 验证成功后自动跳转到设置页面

### 3. 会话管理

- **查看会话状态**：设置页面顶部显示剩余会话时间
- **手动退出**：点击"退出"按钮可以手动结束会话
- **自动过期**：30分钟后会话自动过期，需要重新验证

## 安全建议

### 🔑 密码设置
- 使用强密码（至少8位，包含字母、数字、特殊字符）
- 定期更换密码
- 不要在代码中硬编码密码

### 🌐 生产环境
- 务必设置自定义的管理员密码
- 考虑使用更复杂的认证机制（如JWT、OAuth等）
- 启用HTTPS保护数据传输

### 📝 日志监控
- 监控密码验证失败的尝试
- 记录设置页面的访问日志
- 定期检查异常访问行为

## 技术实现

### 组件结构
```
src/
├── components/
│   ├── ui/
│   │   └── PasswordModal.tsx      # 密码验证弹窗
│   ├── home/
│   │   └── Header.tsx             # 修改后的头部组件
│   └── settings/
│       └── SettingsPage.tsx       # 修改后的设置页面
├── app/api/auth/
│   └── verify-password/
│       └── route.ts               # 密码验证API
└── lib/
    └── auth.ts                    # 会话管理工具
```

### API端点
- `POST /api/auth/verify-password` - 验证管理员密码
- `GET /api/auth/verify-password` - 检查会话状态

### 会话管理
- 使用 `sessionStorage` 存储会话状态
- 会话有效期：30分钟
- 自动刷新会话时间
- 定期检查会话有效性

## 故障排除

### 常见问题

**Q: 忘记了管理员密码怎么办？**
A: 如果使用环境变量设置密码，检查 `.env.local` 文件；如果使用默认密码，密码是 `1Allforone`。

**Q: 会话经常过期怎么办？**
A: 会话有效期是30分钟，如果需要延长，可以修改 `src/lib/auth.ts` 中的 `SESSION_DURATION` 常量。

**Q: 密码验证失败怎么办？**
A: 检查密码是否正确，确保没有多余的空格。如果问题持续，检查服务器日志。

**Q: 如何禁用密码保护？**
A: 如果需要临时禁用密码保护，可以修改 `Header.tsx` 组件，直接跳转到设置页面而不进行验证。

### 开发调试

在开发环境中，可以通过浏览器控制台查看会话状态：
```javascript
// 检查认证状态
console.log(sessionStorage.getItem('admin-authenticated'));

// 查看认证时间
console.log(sessionStorage.getItem('admin-auth-time'));

// 手动清除会话
sessionStorage.removeItem('admin-authenticated');
sessionStorage.removeItem('admin-auth-time');
```

## 更新日志

- **v1.0.0** - 初始版本，基础密码保护功能
- 支持环境变量配置密码
- 30分钟会话管理
- 密码验证弹窗
- 会话状态显示
- 手动退出功能
